global:
  hostname: 
  esignetBaseUrl: https://qafr.dpgongcp.com

postgresql:
  enabled: false

spar-mapper-api:
  enabled: true
  postgresql:
    enabled: false
  envVars:
    SPAR_MAPPER_DB_HOSTNAME: ""
    SPAR_MAPPER_DB_USERNAME: "postgres"
    SPAR_MAPPER_DB_DBNAME: "spardb"
  envVarsFrom:
    SPAR_MAPPER_DB_PASSWORD:
      secretKeyRef:
        name: 'external-db-secret'
        key: 'SQL_PASS'

spar-self-service-api:
  enabled: true
  postgresql:
    enabled: false
  envVars:
    SPAR_SELFSERVICE_DB_HOSTNAME: ""
    SPAR_SELFSERVICE_DB_USERNAME: "postgres"
    SPAR_SELFSERVICE_DB_DBNAME: "spardb"
    SPAR_SELFSERVICE_MAPPER_API_URL: 'http://{{ .Release.Name }}-spar-mapper-api/sync'
    SPAR_SELFSERVICE_AUTH_DEFAULT_ISSUERS: '["{{ .Values.global.esignetBaseUrl }}/v1/esignet"]'
    SPAR_SELFSERVICE_AUTH_DEFAULT_JWKS_URLS: '["{{ .Values.global.esignetBaseUrl }}/v1/esignet/oauth/.well-known/jwks.json"]'
  envVarsFrom:
    SPAR_SELFSERVICE_DB_PASSWORD:
      secretKeyRef:
        name: 'external-db-secret'
        key: 'SQL_PASS'


spar-self-service-ui:
  enabled: true

istio:
  enabled: true
  virtualservice:
    enabled: true
    host: {{_DOMAIN_}}
    gateway: "internal"
    routes:
      - match:
          - uri:
              prefix: /api/selfservice/
        rewrite:
          uri: /
        route:
          - destination:
              host: spar-spar-self-service-api
              port:
                number: 80
      - match:
          - uri:
              prefix: /api/mappers
        rewrite:
            uri: / 
        route:
          - destination:
              host: spar-spar-mapper-api  
              port:
                number: 80
      - match:
          - uri:
              prefix: /
          rewrite:
              uri: / 
        route:
          - destination:
              host: spar-spar-self-service-ui  
              port:
                number: 80
      